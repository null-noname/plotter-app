<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>プロッター</title>

    <!-- Firebase SDK Compat (CDN) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="view-container">
        <div class="card-retro" style="text-align: center; padding: 40px;">
            <h1 class="title-bar">プロッター</h1>
            <p style="margin-bottom: 30px; color: #888;">作品設定・キャラクター管理ツール</p>
            <button id="google-login-btn" class="btn-retro large blue">Googleでログイン</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" style="display: none;">
        <header class="main-header" style="display:block; padding: 10px 20px 0 20px; height: auto;">
            <!-- Row 1: Logo & Logout -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span class="app-logo">プロッター</span>
                <button class="btn-icon" style="background:transparent; color:#888;">ログアウト</button>
            </div>

            <!-- Row 2: TOP画面に戻る (左寄せ) -->
            <div style="margin-bottom:10px; min-height: 32px; display: flex; align-items: center;">
                <button id="common-back-to-top" class="btn-retro back-to-top"
                    style="font-size:0.85rem; padding:4px 16px; display:none;">TOP画面に戻る</button>
            </div>
            <!-- Row 3: Tab Navigation -->
            <nav class="tab-nav" style="border-bottom: none; background: transparent; margin: 0;">
                <button class="tab-btn" data-tab="work-info">作品情報</button>
                <button class="tab-btn" data-tab="plot">プロット</button>
                <button class="tab-btn" data-tab="characters">登場人物</button>
                <button class="tab-btn" data-tab="memo">メモ</button>
            </nav>
        </header>

        <!-- Tab Contents -->
        <main class="content-area">
            <!-- TOP Tab -->
            <section id="tab-top" class="tab-content active">
                <div id="work-list-view">
                    <div style="margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:15px;">
                        <!-- Row 1: 作品一覧 (左寄せ) -->
                        <div style="text-align:left; margin-bottom:10px;">
                            <h2 class="retro-subtitle" style="margin:0; font-size:1.1rem; color:#fff;">作品一覧</h2>
                        </div>
                        <!-- Row 2: ＋新規作成 (中央寄せ) -->
                        <div style="text-align:center; margin-bottom:10px;">
                            <button id="new-work-btn" class="btn-retro save"
                                style="padding:6px 24px; font-size:1rem;">＋新規作成</button>
                        </div>
                        <!-- Row 3: ソート (右寄せ) -->
                        <div style="display:flex; justify-content:flex-end; align-items:center; gap:8px;">
                            <label style="font-size:0.75rem; color:#666;">並び替え:</label>
                            <select id="work-sort-order" class="select-retro"
                                style="font-size:0.85rem; padding:4px 8px; background:#111; color:#fff;">
                                <option value="updatedAt_desc">更新日（新）</option>
                                <option value="updatedAt_asc">更新日（古）</option>
                                <option value="createdAt_desc">作成日（新）</option>
                                <option value="createdAt_asc">作成日（古）</option>
                            </select>
                        </div>
                    </div>
                    <div id="work-grid-container" class="work-grid">
                        <!-- Loaded via dashboard.js -->
                        <div style="text-align:center; padding:40px; color:#666;">読み込み中...</div>
                    </div>
                </div>

                <!-- Work Editor/Setup (Hidden by default for New Work) -->
                <div id="work-new-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="work-new-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">戻る</button>
                        <h2 class="retro-subtitle" style="margin:0; flex:1; text-align:center;">新規作品の作成</h2>
                        <div style="width:60px;"></div> <!-- Spacer to keep title centered -->
                    </div>
                    <div id="work-form-container-new"></div>
                </div>
            </section>

            <!-- Work Info Tab -->
            <section id="tab-work-info" class="tab-content">
                <!-- View Mode -->
                <div id="work-view-view">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
                        <h2 class="retro-subtitle" style="margin:0;">作品情報</h2>
                        <button id="work-view-edit-btn" class="btn-retro save"
                            style="padding:4px 16px; font-size:0.8rem;">編集</button>
                    </div>
                    <div id="work-view-container">
                        <div style="text-align:center; padding:40px; color:#666;">作品情報を読み込み中...</div>
                    </div>
                </div>

                <!-- Edit Mode (Hidden by default) -->
                <div id="work-edit-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="work-edit-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">キャンセル</button>
                        <h2 class="retro-subtitle" style="margin:0; flex:1; text-align:center;">作品情報の編集</h2>
                        <div style="width:60px;"></div> <!-- Spacer -->
                    </div>
                    <div id="work-form-container-info"></div>
                </div>
            </section>

            <!-- Plot Tab -->
            <section id="tab-plot" class="tab-content">
                <div id="plot-list-view">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
                        <h2 class="retro-subtitle" style="margin:0;">プロット一覧</h2>
                        <button id="plot-new-btn" class="btn-retro save">＋新規プロット</button>
                    </div>
                    <div id="plot-list-container">
                        <!-- Loaded via plot.js -->
                    </div>
                </div>

                <!-- Plot View Mode (Hidden by default) -->
                <div id="plot-view-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="plot-view-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">戻る</button>
                        <h2 id="plot-view-title-label" class="retro-subtitle"
                            style="margin:0; flex:1; text-align:center; font-size:1.2rem;">プロット閲覧</h2>
                        <button id="plot-view-edit-btn" class="btn-retro save"
                            style="padding:4px 16px; font-size:0.8rem;">編集</button>
                    </div>
                    <div class="card-retro">
                        <h3 id="plot-view-title"
                            style="color:#fff; font-size:1.4rem; margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
                        </h3>

                        <!-- For Basic Plot -->
                        <div id="plot-view-basic-content"
                            style="white-space:pre-wrap; color:#ddd; line-height:1.6; font-size:1.1rem;"></div>

                        <!-- For Timeline -->
                        <div id="plot-view-timeline-content" style="display:none;">
                            <div id="plot-view-timeline-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Plot Editor (Hidden by default) -->
                <div id="plot-edit-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="plot-edit-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">戻る</button>
                        <div id="plot-type-selector" style="flex:1; display:flex; justify-content:center; gap:10px;">
                            <button id="plot-type-normal" class="btn-retro active">基本プロット</button>
                            <button id="plot-type-timeline" class="btn-retro">タイムライン</button>
                        </div>
                        <div style="width:60px;"></div> <!-- Spacer -->
                    </div>
                    <div class="card-retro">
                        <label class="gold-bold">章題</label>
                        <input type="text" id="plot-title" placeholder="章のタイトルを入力..."
                            style="width:100%; padding:10px; background:#111; border:1px solid #444; color:#fff; font-size:1.2rem; margin-bottom:20px;">

                        <!-- Basic Plot Content (Shown in "Normal" mode) -->
                        <div id="plot-basic-content">
                            <label class="gold-bold">内容</label>
                            <textarea id="plot-content" placeholder="プロット本文を入力..."
                                style="width:100%; height:450px; padding:12px; background:#111; border:1px solid #444; color:#fff; font-size:1.1rem; resize:none; margin-bottom:20px;"></textarea>
                        </div>

                        <!-- Timeline Content (Shown in "Timeline" mode) -->
                        <div id="plot-timeline-view" style="display:none; margin-bottom:20px;">
                            <label class="gold-bold">タイムライン</label>
                            <div id="plot-timeline-list" style="margin-top:10px;">
                                <!-- Timeline entries will be added here -->
                            </div>
                            <div style="text-align:center; margin-top:20px;">
                                <button id="plot-timeline-add-btn" class="btn-retro"
                                    style="padding:8px 30px; font-size:0.9rem; border-color:var(--clr-save); color:var(--clr-save);">＋エントリー追加</button>
                            </div>
                        </div>

                        <div style="text-align:center; padding-top:20px; border-top:1px solid #333;">
                            <button id="plot-save-btn" class="btn-retro save"
                                style="padding:10px 80px; font-size:1.1rem;">保存</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Character Tab -->
            <section id="tab-characters" class="tab-content">
                <!-- Character View Mode (Hidden by default) -->
                <div id="char-view-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="char-view-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">戻る</button>
                        <h2 id="char-view-title-label" class="retro-subtitle"
                            style="margin:0; flex:1; text-align:center; font-size:1.2rem;">キャラ閲覧</h2>
                        <button id="char-view-edit-btn" class="btn-retro save"
                            style="padding:4px 16px; font-size:0.8rem;">編集</button>
                    </div>
                    <div class="card-retro">
                        <div style="display:flex; gap:25px; margin-bottom:25px; align-items: flex-start;">
                            <!-- Larger Icon Container -->
                            <div id="char-view-icon"
                                style="width:200px; height:200px; background:#111; border:2px solid #555; overflow:hidden; display:flex; align-items:center; justify-content:center; flex-shrink:0; border-radius:4px;">
                            </div>
                            <!-- Name & Stats Grid -->
                            <div style="flex:1; display:flex; flex-direction:column; gap:12px;">
                                <div
                                    style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; border-bottom:1px solid #444; padding-bottom:10px;">
                                    <div>
                                        <div id="char-view-last-ruby"
                                            style="font-size:0.75rem; color:rgba(255,255,255,0.8);"></div>
                                        <div id="char-view-last-name"
                                            style="font-size:1.6rem; color:#fff; font-weight:bold;"></div>
                                    </div>
                                    <div>
                                        <div id="char-view-first-ruby"
                                            style="font-size:0.75rem; color:rgba(255,255,255,0.8);"></div>
                                        <div id="char-view-first-name"
                                            style="font-size:1.6rem; color:#fff; font-weight:bold;"></div>
                                    </div>
                                </div>
                                <div
                                    style="padding-bottom:8px; border-bottom:1px solid #444; display:flex; gap:8px; align-items:center;">
                                    <label class="gold-bold" style="font-size:0.85rem; flex-shrink:0;">別名：</label>
                                    <div id="char-view-alias" style="color:#fff; font-size:1.1rem; font-weight:bold;">
                                    </div>
                                </div>
                                <div
                                    style="padding-bottom:8px; border-bottom:1px solid #333; display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center;">
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <label class="gold-bold" style="font-size:0.85rem; flex-shrink:0;">誕生日：</label>
                                        <div id="char-view-birth" style="color:#fff;"></div>
                                    </div>
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <label class="gold-bold" style="font-size:0.85rem; flex-shrink:0;">年齢：</label>
                                        <div id="char-view-age" style="color:#fff;"></div>
                                    </div>
                                </div>
                                <div
                                    style="padding-bottom:8px; border-bottom:1px solid #333; display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center;">
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <label class="gold-bold" style="font-size:0.85rem; flex-shrink:0;">役職：</label>
                                        <div id="char-view-role" style="color:#fff;"></div>
                                    </div>
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <label class="gold-bold" style="font-size:0.85rem; flex-shrink:0;">身長：</label>
                                        <div id="char-view-height" style="color:#fff;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="char-view-memos"
                            style="display:flex; flex-direction:column; gap:20px; border-top:1px solid #444; padding-top:20px;">
                            <!-- Long memos like looks, history, custom items -->
                        </div>
                    </div>
                </div>

                <div id="char-list-view">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
                        <h2 class="retro-subtitle" style="margin:0;">登場人物</h2>
                        <button id="char-new-btn" class="btn-retro save">＋新規キャラ</button>
                    </div>
                    <div id="char-list-container">
                        <!-- Loaded via characters.js -->
                    </div>
                </div>

                <!-- Character Editor (Hidden by default) -->
                <div id="char-edit-view" style="display:none;">
                    <div
                        style="display:flex; gap:10px; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
                        <button id="char-edit-back" class="btn-retro back"
                            style="padding:4px 12px; font-size:0.8rem;">戻る</button>
                        <h2 class="retro-subtitle" style="margin:0; flex:1; text-align:center; font-size:1.2rem;">キャラ編集
                        </h2>
                        <div style="width:60px;"></div>
                    </div>

                    <div class="card-retro">
                        <!-- Top Section: Icon & Grid Name -->
                        <div style="display:flex; gap:20px; margin-bottom:20px; align-items: flex-start;">
                            <div style="text-align:center;">
                                <div id="char-icon-preview"
                                    style="width:180px; height:180px; background:#111; border:2px solid #555; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:4px;">
                                    <span style="color:#444;">No Image</span>
                                </div>
                                <button id="char-icon-change-btn" class="btn-retro"
                                    style="font-size:0.7rem; padding:4px 8px; margin-top:8px; width:100%;">画像変更</button>
                                <input type="file" id="char-icon-input" style="display:none;" accept="image/*">
                            </div>
                            <!-- Name & Basic Info Grid Editor -->
                            <div style="flex:1; display:flex; flex-direction:column; gap:12px;">
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">名字ルビ</label>
                                        <input type="text" id="char-last-ruby" placeholder="ルビ"
                                            style="width:100%; padding:6px; background:#111; border:1px solid #444; color:#fff; font-size:0.85rem;">
                                    </div>
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">名前ルビ</label>
                                        <input type="text" id="char-first-ruby" placeholder="ルビ"
                                            style="width:100%; padding:6px; background:#111; border:1px solid #444; color:#fff; font-size:0.85rem;">
                                    </div>
                                </div>
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">名字</label>
                                        <input type="text" id="char-last-name" placeholder="名字"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; font-size:1.1rem;">
                                    </div>
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">名前</label>
                                        <input type="text" id="char-first-name" placeholder="名前"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; font-size:1.1rem;">
                                    </div>
                                </div>
                                <div>
                                    <label class="gold-bold" style="font-size:0.7rem;">別名</label>
                                    <input type="text" id="char-alias"
                                        style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;">
                                </div>
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">誕生日</label>
                                        <input type="text" id="char-birth"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;">
                                    </div>
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">年齢</label>
                                        <input type="text" id="char-age"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;">
                                    </div>
                                </div>
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">役職</label>
                                        <input type="text" id="char-role"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;">
                                    </div>
                                    <div>
                                        <label class="gold-bold" style="font-size:0.7rem;">身長</label>
                                        <input type="text" id="char-height"
                                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mid Section: Detail Memos -->
                        <div id="char-memos-container">
                            <div class="char-memo-item" style="margin-bottom:12px;">
                                <label class="gold-bold" style="font-size:0.75rem;">見た目・性格</label>
                                <textarea id="char-looks"
                                    style="width:100%; height:80px; padding:8px; background:#111; border:1px solid #444; color:#fff; resize:none;"></textarea>
                            </div>
                            <div class="char-memo-item" style="margin-bottom:12px;">
                                <label class="gold-bold" style="font-size:0.75rem;">特技</label>
                                <textarea id="char-skill"
                                    style="width:100%; height:60px; padding:8px; background:#111; border:1px solid #444; color:#fff; resize:none;"></textarea>
                            </div>
                            <div class="char-memo-item" style="margin-bottom:12px;">
                                <label class="gold-bold" style="font-size:0.75rem;">生い立ち</label>
                                <textarea id="char-history"
                                    style="width:100%; height:100px; padding:8px; background:#111; border:1px solid #444; color:#fff; resize:none;"></textarea>
                            </div>
                            <div id="char-custom-items">
                                <!-- Dynamic items -->
                            </div>
                            <button id="char-item-add-btn" class="btn-retro"
                                style="font-size:0.9rem; padding:4px 12px;">＋項目追加</button>
                        </div>
                        <div style="text-align:center; padding-top:20px; border-top:1px solid #333; margin-top:20px;">
                            <button id="char-save-btn" class="btn-retro save"
                                style="padding:10px 80px; font-size:1.1rem;">保存</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Memo Tab -->
            <section id="tab-memo" class="tab-content">
                <div id="memo-list-view">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
                        <h2 class="retro-subtitle" style="margin:0;">メモ一覧</h2>
                        <button class="btn-retro save">＋新規メモ</button>
                    </div>
                    <div id="memo-filter-bar" style="margin-bottom:16px;">
                        <!-- Tag filters will appear here -->
                    </div>
                    <div id="memo-list-container">
                        <!-- Loaded via memo.js -->
                    </div>
                </div>

                <!-- Memo Editor/Viewer (Hidden by default) -->
                <div id="memo-edit-view" style="display:none;">
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn-retro back">戻る</button>
                        <button class="btn-retro save" style="margin-left:auto;">保存</button>
                    </div>
                    <div class="card-retro">
                        <input type="text" id="memo-title" placeholder="タイトル"
                            style="width:100%; padding:10px; background:#111; border:1px solid #444; color:#fff; font-size:1.2rem; margin-bottom:12px;">
                        <input type="text" id="memo-tags" placeholder="タグ (カンマ区切り)"
                            style="width:100%; padding:8px; background:#111; border:1px solid #444; color:#fff; margin-bottom:12px;">
                        <textarea id="memo-content" placeholder="内容"
                            style="width:100%; height:400px; padding:12px; background:#111; border:1px solid #444; color:#fff; font-size:1.1rem; resize:none;"></textarea>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals / Overlays for View/Edit modes will be added later -->

    <!-- Scripts (Modularized) -->
    <script type="module" src="js/main.js"></script>
</body>

</html>